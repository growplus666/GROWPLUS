<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Papyrus</title>
    
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;600&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-deep: #050505;
            --bg-card: rgba(255, 255, 255, 0.03);
            --accent: #9d4edd;
            --accent-glow: rgba(157, 78, 221, 0.4);
            --text-main: #ffffff;
            --text-muted: #888888;
            --font-display: 'Playfair Display', serif;
            --font-tech: 'Space Grotesk', sans-serif;
            --font-code: 'Space Mono', monospace;
            --ease-quart: cubic-bezier(0.76, 0, 0.24, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-tech);
            height: 100vh;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: fixed;
        }

        /* --- ATMOSPHERE --- */
        .noise {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuNjUiIG51bU9jdGF2ZXM9IjMiIHN0aXRjaFRpbGVzPSJzdGl0Y2giLz48L2ZpbHRlcj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWx0ZXI9InVybCgjbm9pc2UpIiBvcGFjaXR5PSIxIi8+PC9zdmc+');
            opacity: 0.05;
            pointer-events: none;
            z-index: 1;
        }

        .ambient-glow {
            position: fixed;
            width: 800px; height: 800px;
            background: radial-gradient(circle, rgba(157, 78, 221, 0.1) 0%, transparent 70%);
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 0;
            animation: pulseGlow 10s infinite alternate;
        }

        /* --- LOADER --- */
        #loader-curtain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999; display: flex; pointer-events: all;
        }
        .curtain-panel { width: 50%; height: 100%; background: #000; position: relative; z-index: 2; transition: transform 1.5s var(--ease-quart); }
        .curtain-left { border-right: 1px solid rgba(255,255,255,0.1); }
        .curtain-right { border-left: 1px solid rgba(255,255,255,0.1); }
        .loader-content {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 3; text-align: center; width: 100%; transition: opacity 0.5s ease;
        }
        .loader-logo { font-family: var(--font-display); font-size: 4rem; color: #fff; opacity: 0; animation: revealLogo 2s forwards; }
        .loader-logo span { color: var(--accent); font-style: italic; }
        .loader-creator { font-size: 0.8rem; letter-spacing: 4px; text-transform: uppercase; color: #666; margin-top: 15px; opacity: 0; animation: fadeIn 1s 1.5s forwards; }
        
        body.loaded #loader-curtain { pointer-events: none; }
        body.loaded .curtain-left { transform: translateX(-100%); }
        body.loaded .curtain-right { transform: translateX(100%); }
        body.loaded .loader-content { opacity: 0; }

        /* --- UI STRUCTURE --- */
        header {
            padding: 30px 40px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }
        .brand { font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; }
        
        main {
            flex: 1; overflow-y: auto; padding: 20px 40px; z-index: 5;
            display: flex; flex-direction: column; align-items: center;
            scrollbar-width: none;
        }
        main::-webkit-scrollbar { display: none; }

        .hero-section {
            text-align: center; margin: 40px 0 60px 0;
            opacity: 0; transform: translateY(20px);
            animation: slideUp 1s 2.2s forwards;
        }
        .hero-title { font-family: var(--font-display); font-size: 3.5rem; margin-bottom: 10px; }
        .hero-sub { color: var(--text-muted); font-size: 1rem; max-width: 500px; margin: 0 auto; line-height: 1.6; }

        /* --- TOOLS GRID --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            padding-bottom: 50px;
            opacity: 0; transform: translateY(20px);
            animation: slideUp 1s 2.4s forwards;
        }

        .tool-card {
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.08);
            padding: 30px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.4s var(--ease-quart);
            position: relative;
            overflow: hidden;
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .tool-card:hover {
            border-color: var(--accent);
            background: rgba(157, 78, 221, 0.05);
            transform: translateY(-5px);
        }

        .tool-icon {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .tool-name { font-family: var(--font-display); font-size: 1.4rem; margin-bottom: 5px; }
        .tool-desc { font-size: 0.8rem; color: #666; }

        /* --- WORKSPACE OVERLAY (Modal) --- */
        #workspace {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #050505; z-index: 50;
            display: flex; flex-direction: column;
            transform: translateY(100%);
            transition: transform 0.6s var(--ease-quart);
        }
        #workspace.active { transform: translateY(0); }

        .ws-header {
            padding: 30px 50px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .ws-title { font-family: var(--font-display); font-size: 1.5rem; }
        .ws-close { cursor: pointer; font-size: 1.5rem; transition: 0.3s; }
        .ws-close:hover { color: var(--accent); }

        .ws-body {
            flex: 1; display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative;
        }

        /* --- UPLOAD ZONE --- */
        .upload-zone {
            width: 80%; max-width: 600px; height: 300px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transition: 0.3s;
            cursor: pointer;
            background: rgba(255,255,255,0.01);
        }
        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--accent);
            background: rgba(157, 78, 221, 0.05);
        }
        .upload-icon { font-size: 3rem; color: #444; margin-bottom: 20px; transition: 0.3s; }
        .upload-zone:hover .upload-icon { color: var(--accent); }
        .upload-text { font-size: 1.1rem; color: #fff; margin-bottom: 10px; }
        .upload-sub { color: #666; font-size: 0.9rem; }
        
        #fileInput { display: none; }

        /* --- PROCESSING STATE --- */
        .process-view {
            display: none;
            text-align: center;
            width: 100%;
        }
        .loader-bar {
            width: 300px; height: 2px; background: #222; margin: 20px auto;
            position: relative; overflow: hidden;
        }
        .loader-progress {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: var(--accent);
            box-shadow: 0 0 10px var(--accent);
            transition: width 0.1s linear;
        }
        .terminal-text {
            font-family: var(--font-code); color: #888; font-size: 0.8rem;
            margin-top: 10px; min-height: 20px;
        }

        /* --- DOWNLOAD STATE --- */
        .download-view { display: none; text-align: center; animation: fadeIn 0.5s; }
        .btn-download {
            background: #fff; color: #000; border: none; padding: 15px 40px;
            font-family: var(--font-tech); font-weight: 600; font-size: 1rem;
            cursor: pointer; transition: 0.3s; margin-top: 20px;
            display: inline-flex; align-items: center; gap: 10px;
        }
        .btn-download:hover { background: var(--accent); color: #fff; box-shadow: 0 0 20px var(--accent-glow); }

        /* Animations */
        @keyframes revealLogo { 0% { opacity: 0; filter: blur(10px); } 100% { opacity: 1; filter: blur(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); } }

        /* Responsive */
        @media(max-width: 800px) {
            .grid { grid-template-columns: 1fr; }
            .hero-title { font-size: 12vw; }
            header { padding: 20px; }
            main { padding: 20px; }
            .ws-header { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="noise"></div>
    <div class="ambient-glow"></div>

    <div id="loader-curtain">
        <div class="curtain-panel curtain-left"></div>
        <div class="loader-content">
            <div class="loader-logo">PAPYRUS</div>
            <div class="loader-creator">By Avishkar Kubal</div>
        </div>
        <div class="curtain-panel curtain-right"></div>
    </div>

    <header>
        <div class="brand">PAPYRUS</div>
        <div style="font-size: 0.9rem; color: #666; text-transform: uppercase; letter-spacing: 2px;">V 1.0</div>
    </header>

    <main>
        <div class="hero-section">
            <h1 class="hero-title">The Digital Scroll</h1>
            <p class="hero-sub">A sovereign suite of PDF utilities. Client-side processing for maximum privacy.</p>
        </div>

        <div class="grid">
            <div class="tool-card" onclick="openTool('merge')">
                <div class="tool-icon">âš¯</div>
                <div>
                    <div class="tool-name">Merge PDF</div>
                    <div class="tool-desc">Combine multiple files into one.</div>
                </div>
            </div>

            <div class="tool-card" onclick="openTool('jpg2pdf')">
                <div class="tool-icon">ðŸ–¼</div>
                <div>
                    <div class="tool-name">JPG to PDF</div>
                    <div class="tool-desc">Convert images to documents.</div>
                </div>
            </div>

            <div class="tool-card" onclick="openTool('compress')">
                <div class="tool-icon">ðŸ“‰</div>
                <div>
                    <div class="tool-name">Compress</div>
                    <div class="tool-desc">Reduce file size securely.</div>
                </div>
            </div>
        </div>
    </main>

    <div id="workspace">
        <div class="ws-header">
            <div class="ws-title" id="wsTitle">Tool Name</div>
            <div class="ws-close" onclick="closeWorkspace()">&times;</div>
        </div>
        <div class="ws-body">
            
            <div id="uploadView" class="upload-zone" onclick="triggerFile()" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
                <div class="upload-icon">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                </div>
                <div class="upload-text">Drop files here or click to upload</div>
                <div class="upload-sub" id="fileLimitText">Supports JPG, PNG or PDF</div>
                <input type="file" id="fileInput" multiple onchange="handleFiles(this.files)">
            </div>

            <div id="processView" class="process-view">
                <h2 style="font-family: var(--font-display); font-weight: 400; margin-bottom: 20px;">Processing...</h2>
                <div class="loader-bar"><div class="loader-progress" id="progressBar"></div></div>
                <div class="terminal-text" id="terminal">Initializing core...</div>
            </div>

            <div id="downloadView" class="download-view">
                <h2 style="font-family: var(--font-display); font-weight: 400;">Ready</h2>
                <p style="color: #666; margin-top: 10px;">Your document has been processed.</p>
                <button class="btn-download" onclick="triggerDownload()">
                    <span>DOWNLOAD FILE</span>
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentTool = null;
        let processedFile = null;
        let processedFileName = "document.pdf";

        const { PDFDocument } = PDFLib;

        // --- LOADER ---
        window.addEventListener('load', () => {
            setTimeout(() => document.body.classList.add('loaded'), 2500);
        });

        // --- UI LOGIC ---
        function openTool(tool) {
            currentTool = tool;
            const titles = {
                'merge': 'Merge PDF',
                'jpg2pdf': 'JPG to PDF',
                'compress': 'Compress PDF'
            };
            
            document.getElementById('wsTitle').innerText = titles[tool];
            document.getElementById('fileLimitText').innerText = 
                (tool === 'jpg2pdf') ? "Supports JPG, PNG Images" : "Supports PDF Files";
            
            // Accept types
            const input = document.getElementById('fileInput');
            input.value = ''; 
            if (tool === 'jpg2pdf') input.accept = "image/*";
            else input.accept = ".pdf";

            // Reset Views
            document.getElementById('uploadView').style.display = 'flex';
            document.getElementById('processView').style.display = 'none';
            document.getElementById('downloadView').style.display = 'none';

            document.getElementById('workspace').classList.add('active');
        }

        function closeWorkspace() {
            document.getElementById('workspace').classList.remove('active');
        }

        function triggerFile() {
            document.getElementById('fileInput').click();
        }

        function allowDrop(ev) { ev.preventDefault(); }
        function handleDrop(ev) {
            ev.preventDefault();
            handleFiles(ev.dataTransfer.files);
        }

        // --- CORE LOGIC ---
        async function handleFiles(files) {
            if (files.length === 0) return;

            document.getElementById('uploadView').style.display = 'none';
            document.getElementById('processView').style.display = 'block';

            if (currentTool === 'jpg2pdf') {
                await processImagesToPDF(files);
            } else if (currentTool === 'merge') {
                await processMergePDF(files);
            } else if (currentTool === 'compress') {
                await simulateProcessing(files);
            }
        }

        // --- FEATURE: IMG TO PDF ---
        async function processImagesToPDF(files) {
            updateTerminal("Reading image data...");
            await simulateProgress(30);

            try {
                const pdfDoc = await PDFDocument.create();
                
                for (let i = 0; i < files.length; i++) {
                    updateTerminal(`Processing image ${i+1}/${files.length}...`);
                    const file = files[i];
                    const buffer = await file.arrayBuffer();
                    
                    let image;
                    if (file.type === 'image/jpeg') image = await pdfDoc.embedJpg(buffer);
                    else if (file.type === 'image/png') image = await pdfDoc.embedPng(buffer);
                    else continue;

                    const page = pdfDoc.addPage([image.width, image.height]);
                    page.drawImage(image, {
                        x: 0, y: 0, width: image.width, height: image.height,
                    });
                }

                updateTerminal("Finalizing document...");
                await simulateProgress(90);
                
                const pdfBytes = await pdfDoc.save();
                processedFile = new Blob([pdfBytes], { type: "application/pdf" });
                processedFileName = "converted_images.pdf";
                
                finishProcessing();

            } catch (err) {
                alert("Error processing images: " + err);
                closeWorkspace();
            }
        }

        // --- FEATURE: MERGE PDF ---
        async function processMergePDF(files) {
            updateTerminal("Reading PDF structures...");
            await simulateProgress(20);

            try {
                const mergedPdf = await PDFDocument.create();

                for (let i = 0; i < files.length; i++) {
                    updateTerminal(`Merging file ${i+1}...`);
                    const buffer = await files[i].arrayBuffer();
                    const pdf = await PDFDocument.load(buffer);
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                updateTerminal("Rebuilding XRef table...");
                await simulateProgress(80);

                const pdfBytes = await mergedPdf.save();
                processedFile = new Blob([pdfBytes], { type: "application/pdf" });
                processedFileName = "merged_document.pdf";
                
                finishProcessing();

            } catch (err) {
                alert("Error merging PDFs: " + err);
                closeWorkspace();
            }
        }

        // --- SIMULATION (For Compress) ---
        async function simulateProcessing(files) {
            updateTerminal("Uploading to secure enclave...");
            await simulateProgress(30);
            updateTerminal("Analyzing object streams...");
            await setTimeoutPromise(800);
            updateTerminal("Removing redundant fonts...");
            await simulateProgress(70);
            updateTerminal("Recompressing assets...");
            await setTimeoutPromise(800);
            
            processedFile = files[0]; 
            processedFileName = "compressed_" + files[0].name;
            
            finishProcessing();
        }

        // --- UTILS ---
        function updateTerminal(text) {
            document.getElementById('terminal').innerText = text;
        }

        function simulateProgress(target) {
            return new Promise(resolve => {
                const bar = document.getElementById('progressBar');
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= target) {
                        clearInterval(interval);
                        resolve();
                    } else {
                        width++;
                        bar.style.width = width + '%';
                    }
                }, 10);
            });
        }

        function setTimeoutPromise(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function finishProcessing() {
            document.getElementById('progressBar').style.width = '100%';
            updateTerminal("Done.");
            setTimeout(() => {
                document.getElementById('processView').style.display = 'none';
                document.getElementById('downloadView').style.display = 'block';
            }, 500);
        }

        function triggerDownload() {
            download(processedFile, processedFileName, "application/pdf");
        }
    </script>
</body>
</html>